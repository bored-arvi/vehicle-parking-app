<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Reservations</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- Hidden user info (required for fetching) -->
<div id="user-info" data-user="{{ session['user_id'] }}"></div>

<div class="container mt-5">
  <h3>Your Reservations</h3>
  <div id="user-reservations" class="mt-3"></div>
</div>
<!-- Navbar -->
<nav class="navbar bg-light p-2 position-fixed top-0 start-0 z-3" style="width:auto;">
  <button class="btn btn-outline-dark" data-bs-toggle="offcanvas" data-bs-target="#adminSidebar">
    â˜° 
  </button>
</nav>
<div class="offcanvas offcanvas-start" tabindex="-1" id="adminSidebar">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">User Panel</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <a href="/dashboard/user" class="d-block py-2 text-dark">Dashboard</a>
    <a href="/dashboard/user/reservations" class="d-block py-2 text-dark">My Reservations</a>
    <a href="/dashboard/user/charts" class="d-block py-2 text-dark">Summary</a>
    <a href="/logout/user" class="d-block py-2 text-dark">Logout</a>
  </div>
</div>


<script>
const userId = document.getElementById("user-info")?.dataset.user;

async function fetchUserReservations() {
  const res = await fetch('/api/reservations/user/' + userId);
  const data = await res.json();
  const container = document.getElementById('user-reservations');

  if (!data.length) {
    container.innerHTML = '<p>No active reservations.</p>';
    return;
  }

  let table = `
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Vehicle No</th>
          <th>Start Time</th>
          <th>End / Action</th>
        </tr>
      </thead>
      <tbody>
  `;

  data.forEach(r => {
    table += `
      <tr>
        <td>${r.id}</td>
        <td>${r.vehicle_no}</td>
        <td>${r.parking_timestamp}</td>
        <td>
          ${r.leaving_timestamp 
              ? r.leaving_timestamp 
              : `<button class="btn btn-danger btn-sm" onclick="promptRelease(${r.spot_id})">Release</button>`}
        </td>
      </tr>
    `;
  });

  table += '</tbody></table>';
  container.innerHTML = table;
}

window.onload = () => {
  fetchUserReservations();
};
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
